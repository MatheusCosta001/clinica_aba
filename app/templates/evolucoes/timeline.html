{% extends "base.html" %}

{% block title %}
  {% if paciente %}
    Evoluções - {{ paciente.nome }}
  {% else %}
    Evoluções
  {% endif %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">

  {% if not paciente %}
  <h2 class="fw-bold text-primary mb-4">Evoluções</h2>
  <p class="text-muted mb-3">Selecione um paciente para visualizar suas evoluções:</p>

  <div class="card shadow-sm">
    <div class="card-body">
      {% if pacientes %}
      <ul class="list-group list-group-flush">
        {% for p in pacientes %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span class="fw-semibold">{{ p.nome }}</span>
          <a class="btn btn-sm btn-primary" href="{{ url_for('evolucoes.timeline', paciente_id=p.id) }}">
            Ver Evoluções
          </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted mb-0">Nenhum paciente cadastrado.</p>
      {% endif %}
    </div>
  </div>

  {% else %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">Evoluções de {{ paciente.nome }}</h2>
    <div>
      <a class="btn btn-success px-3 me-2" href="{{ url_for('evolucoes.novo', paciente_id=paciente.id) }}">+ Nova Anotação</a>
      <a class="btn btn-outline-secondary px-3" href="{{ url_for('evolucoes.index') }}">← Voltar</a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      {% if evolucoes %}
      <ul class="list-group list-group-flush">
        {% for e in evolucoes %}
        <li class="list-group-item py-3">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="fw-semibold mb-1 text-dark">{{ e.usuario.nome }}</h5>
              <small class="text-muted">{{ e.data_hora.strftime('%d/%m/%Y %H:%M') }}</small>
              <p class="mt-2 mb-0">{{ e.anotacao }}</p>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted text-center py-3 mb-0">Nenhuma evolução cadastrada para este paciente.</p>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
