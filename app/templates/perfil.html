{% extends "base.html" %}
{% block title %}Perfil de {{ user.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">Meu Perfil</h2>

    

    <div class="card shadow-sm p-4 mx-auto" style="max-width: 600px;">
        <div class="text-center mb-4">
            <img src="{{ url_for('static', filename='img/profile_default.png') }}" alt="Foto de perfil" class="rounded-circle border" width="140" height="140" style="object-fit: cover;">
            <h4 class="mt-3">{{ user.nome }}</h4>
            <p class="text-muted mb-0">{{ user.email }}</p>
            <small class="text-secondary">{{ user.papel.capitalize() }}</small>
            {% if user.papel == 'profissional' %}
            <small class="text-secondary d-block">{{ user.especialidade or 'Sem especialidade' }}</small>
            {% endif %}
        </div>

        <div class="list-group list-group-flush mb-4">
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <span class="text-muted">Nome:</span>
                <strong>{{ user.nome }}</strong>
            </div>
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <span class="text-muted">E-mail:</span>
                <strong>{{ user.email }}</strong>
            </div>
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <span class="text-muted">Papel:</span>
                <strong>{{ user.papel.capitalize() }}</strong>
            </div>
            {% if user.papel == 'profissional' %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <span class="text-muted">Especialidade:</span>
                <strong>{{ user.especialidade or 'N√£o informada' }}</strong>
            </div>
            {% endif %}
        </div>

        <div class="d-flex justify-content-center gap-2 mt-4">
            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#alterarSenhaModal">Alterar senha</button>
            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#alterarEmailModal">Alterar e-mail</button>
        </div>
    </div>

        <div class="modal fade" id="alterarSenhaModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form method="POST" action="{{ url_for('auth.alterar_senha') }}">
                        <div class="modal-header">
                            <h5 class="modal-title">Alterar senha</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="senha_atual" class="form-label">Senha atual</label>
                                <div class="input-group">
                                    <input id="senha_atual" name="senha_atual" type="password" class="form-control" required>
                                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#senha_atual">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="nova_senha" class="form-label">Nova senha</label>
                                <div class="input-group">
                                    <input id="nova_senha" name="nova_senha" type="password" class="form-control" required>
                                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#nova_senha">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </button>
                                </div>
                                <div class="form-text">M√≠nimo 6 caracteres e pelo menos 1 caractere especial.</div>
                            </div>
                            <div class="mb-3">
                                <label for="confirmar_nova_senha" class="form-label">Confirmar nova senha</label>
                                <div class="input-group">
                                    <input id="confirmar_nova_senha" name="confirmar_nova_senha" type="password" class="form-control" required>
                                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#confirmar_nova_senha">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            <button type="submit" class="btn btn-primary">Alterar senha</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="alterarEmailModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form method="POST" action="{{ url_for('auth.alterar_email') }}">
                        <div class="modal-header">
                            <h5 class="modal-title">Alterar e-mail</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="email_atual" class="form-label">E-mail atual</label>
                                <input id="email_atual" name="email_atual" type="email" class="form-control" value="{{ user.email }}" readonly>
                            </div>
                            <div class="mb-3">
                                <label for="senha_confirmacao_email" class="form-label">Confirme sua senha</label>
                                <div class="input-group">
                                    <input id="senha_confirmacao_email" name="senha_confirmacao" type="password" class="form-control" required>
                                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#senha_confirmacao_email">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="novo_email" class="form-label">Novo e-mail</label>
                                <input id="novo_email" name="novo_email" type="email" class="form-control" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            <button type="submit" class="btn btn-primary">Alterar e-mail</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <div class="card shadow-sm p-4 mx-auto mt-5" style="max-width: 600px; border-left: 4px solid #dc3545;">
        <h4 class="text-danger mb-3">üîí √Årea de Risco</h4>
        <p class="text-muted small mb-3">
            Esta se√ß√£o permite gerenciar sua conta de forma irrevers√≠vel. Ao excluir sua conta, seus dados pessoais (nome, email, senha e informa√ß√µes sens√≠veis) ser√£o <strong>anonimizados em conformidade com a LGPD</strong>. 
            Seus registros cl√≠nicos e evolu√ß√µes continuar√£o no sistema para fins de continuidade de atendimento, mas sem associa√ß√£o com seus dados identific√°veis.
        </p>
        
        <form method="POST" action="{{ url_for('auth.excluir_conta') }}">
            <div class="mb-3">
                <label for="senha_confirmacao" class="form-label fw-semibold">Senha atual</label>
                <div class="input-group">
                    <input type="password" name="senha_confirmacao" id="senha_confirmacao" class="form-control" placeholder="Senha" required>
                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#senha_confirmacao">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
            </div>

            <div class="mb-3">
                <label for="senha_confirmacao_repeat" class="form-label fw-semibold">Confirme a senha</label>
                <div class="input-group">
                    <input type="password" name="senha_confirmacao_repeat" id="senha_confirmacao_repeat" class="form-control" placeholder="Repita a senha" required>
                    <button class="btn btn-outline-secondary" type="button" tabindex="-1" data-toggle="toggle-password" data-target="#senha_confirmacao_repeat">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
            </div>

            <div class="text-end">
                <button type="submit" class="btn btn-danger" onclick="return confirm('AVISO: Esta a√ß√£o √© irrevers√≠vel. Seus dados pessoais ser√£o exclu√≠dos. Tem certeza?');">Excluir Conta Permanentemente</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
